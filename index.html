<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1e293b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>EmlakPort | Elite CRM</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">

    <script>
        if ('serviceWorker' in navigator) {
            const swUrl = new URL('sw.js', window.location.href).href;
            navigator.serviceWorker.register(swUrl).then(reg => {
                console.log('[App] SW Registered');
            }).catch(err => console.error('[App] SW Registration Failed', err));
        }

        // Immediate Theme Check to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('emlakport_theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <style>
        :root {
            /* Light Theme (Default) */
            --primary: #1e293b;
            --primary-dark: #0f172a;
            --accent: #d4af37;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #111827;
            --text-muted: #64748b;
            --border: #e5e7eb;
            --success: #10b981;
            --danger: #ef4444;
            --shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08);
            --radius: 20px;
            --frame-width: 480px;
            --easing: cubic-bezier(0.4, 0, 0.2, 1);
            --logo-fill: #1e293b;
            --logo-port: #2563eb; /* Sapphire Blue */
        }

        .dark {
            /* Dark Theme (Elite) */
            --bg: #111827;
            --card-bg: #1f2937;
            --text-main: #f9fafb;
            --text-muted: #9ca3af;
            --border: #374151;
            --shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.3);
            --logo-fill: #f9fafb;
            --primary: #f9fafb;
            --logo-port: #60a5fa; /* Sky Blue */
        }

        /* --- THEME TRANSITIONS --- */
        #app, header, .property-card, .btn, .modal-content, .detail-overlay, .form-input, .comm-selector button, body {
            transition: background-color 0.3s var(--easing), color 0.3s var(--easing), border-color 0.3s var(--easing), box-shadow 0.3s var(--easing);
        }

        /* --- SPLASH SCREEN --- */
        #splash {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s var(--easing), visibility 0.8s, background-color 0.3s var(--easing);
        }
        #splash.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .splash-logo {
            width: 180px;
            height: 180px;
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 1.2s var(--easing), transform 1.2s var(--easing);
        }
        .splash-logo.visible {
            opacity: 1;
            transform: scale(1);
        }
        .splash-title {
            margin-top: 0;
            font-family: 'Playfair Display', serif;
            font-size: 2.6rem;
            font-weight: 900;
            color: var(--text-main);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 1s var(--easing), transform 1s var(--easing), color 0.3s var(--easing);
            white-space: nowrap;
        }
        .splash-title.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .tagline {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--accent);
            letter-spacing: 0.2rem;
            text-transform: uppercase;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 1s var(--easing), transform 1s var(--easing);
        }
        .tagline.visible {
            opacity: 0.8;
            transform: translateY(0);
        }

        /* --- LOGO STYLING --- */
        .logo-port {
            color: var(--logo-port);
            transition: color 0.3s var(--easing);
        }

        /* --- BASE LAYOUT --- */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--bg);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
        }

        #app {
            height: 100vh;
            width: 100%;
            max-width: var(--frame-width);
            background-color: var(--bg);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            user-select: none;
            -webkit-user-select: none;
        }

        @media (max-width: 480px) {
            #app { box-shadow: none; max-width: 100%; }
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        input, textarea, select { user-select: text; -webkit-user-select: text; font-family: 'Inter', sans-serif; }

        header {
            background-color: var(--card-bg);
            color: var(--text-main);
            padding: 1rem 1.5rem;
            padding-top: calc(1rem + env(safe-area-inset-top));
            flex-shrink: 0;
            z-index: 40;
            position: sticky;
            top: 0;
            border-bottom: 1px solid var(--border);
        }

        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .logo { 
            display: flex; 
            align-items: center; 
            gap: 0.15rem;
            font-family: 'Playfair Display', serif; 
            font-size: 1.8rem;
            font-weight: 900; 
            color: var(--text-main); 
        }
        .logo-icon { 
            width: 48px;
            height: 48px; 
            fill: var(--logo-fill); 
            transition: fill 0.3s var(--easing); 
        }

        .theme-toggle {
            background: transparent;
            border: none;
            color: var(--text-main);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .theme-toggle:active { background: var(--bg); }
        .theme-toggle svg { width: 24px; height: 24px; stroke: currentColor; fill: none; }

        .search-bar { display: flex; gap: 0.75rem; }
        .search-input-wrapper { position: relative; flex: 1; }
        .search-input-wrapper input {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 0.75rem 0.75rem 0.75rem 2.5rem;
            color: var(--text-main);
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s var(--easing);
        }
        .search-input-wrapper input:focus { border-color: var(--accent); }
        .search-input-wrapper input::placeholder { color: var(--text-muted); }
        .search-input-wrapper svg { position: absolute; left: 0.9rem; top: 50%; transform: translateY(-50%); width: 1.1rem; height: 1.1rem; color: var(--text-muted); }

        .filter-toggle {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 0 1.2rem;
            border-radius: 14px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s var(--easing);
        }
        .filter-toggle.active {
            background: var(--primary);
            color: var(--bg);
            border-color: var(--primary);
        }

        main { flex: 1; padding: 1.5rem; padding-bottom: 7rem; }

        /* --- CARDS --- */
        .property-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform 0.3s var(--easing), box-shadow 0.3s var(--easing);
        }
        .property-card:active {
            transform: scale(0.97) translateY(2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .card-image {
            height: 200px;
            background-color: var(--bg);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .card-image img { width: 100%; height: 100%; object-fit: cover; }
        .card-content { padding: 1.25rem; }
        .card-address {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--text-main);
            line-height: 1.3;
            font-family: 'Inter', sans-serif;
        }
        .card-price {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--text-main);
            font-family: 'Playfair Display', serif;
        }

        .fab {
            position: fixed;
            bottom: 2.5rem;
            left: 50%;
            transform: translateX(calc(-50% + 180px));
            width: 64px;
            height: 64px;
            border-radius: 32px;
            background: var(--primary);
            color: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 35;
            transition: transform 0.2s var(--easing), background-color 0.3s;
        }
        .fab:active { transform: translateX(calc(-50% + 180px)) scale(0.85); }
        @media (max-width: 480px) {
            .fab { left: auto; right: 1.5rem; transform: none; bottom: 1.5rem; }
            .fab:active { transform: scale(0.85); }
        }

        /* --- TRANSITIONS --- */
        .detail-overlay {
            position: fixed;
            inset: 0;
            left: 50%;
            margin: 0;
            width: 100%;
            max-width: var(--frame-width);
            background: var(--bg);
            z-index: 50;
            display: flex;
            flex-direction: column;
            transform: translateX(50%);
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .detail-overlay.active { transform: translateX(-50%); }

        .modal-container {
            position: fixed;
            inset: 0;
            left: 50%;
            width: 100%;
            max-width: var(--frame-width);
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.4s var(--easing);
            transform: translateX(-50%);
        }
        .modal-container.active { visibility: visible; opacity: 1; }

        .modal-content {
            background: var(--card-bg);
            width: 100%;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            padding: 2rem;
            padding-bottom: calc(2rem + env(safe-area-inset-bottom));
            max-height: 90%;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            color: var(--text-main);
        }
        .modal-container.active .modal-content { transform: translateY(0); }

        /* Custom Confirm Modal */
        #confirmModal {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        #confirmModal.active { display: flex; }
        .confirm-box {
            background: var(--card-bg);
            width: 100%;
            max-width: 320px;
            border-radius: 24px;
            padding: 2.5rem 2rem;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border: 1px solid var(--border);
            animation: slide-confirm 0.3s var(--easing);
        }
        @keyframes slide-confirm { 
            from { transform: translateY(20px) scale(0.9); opacity: 0; } 
            to { transform: translateY(0) scale(1); opacity: 1; } 
        }
        .confirm-box h3 { margin: 0 0 1rem; color: var(--text-main); font-weight: 800; font-size: 1.4rem; }
        .confirm-box p { margin: 0 0 2rem; color: var(--text-muted); font-size: 0.95rem; line-height: 1.6; }
        .confirm-actions { display: flex; flex-direction: column; gap: 0.75rem; }

        #toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(15, 23, 42, 0.95);
            color: white;
            padding: 14px 28px;
            border-radius: 40px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 9999;
            visibility: hidden;
            opacity: 0;
            transition: all 0.4s var(--easing);
            max-width: calc(var(--frame-width) - 60px);
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        #toast.show { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(0); }

        /* --- BUTTONS & FORMS --- */
        .btn {
            padding: 1rem;
            border-radius: 16px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-size: 0.95rem;
            transition: all 0.2s var(--easing);
        }
        .btn-primary {
            background: var(--primary);
            color: var(--bg);
            width: 100%;
            box-shadow: 0 8px 20px -4px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:active { transform: scale(0.96); filter: brightness(1.2); }
        .btn-outline {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-main);
        }
        .btn-outline:active { background: var(--bg); transform: scale(0.96); }

        .form-row { margin-bottom: 1.5rem; }
        .form-row label { display: block; font-size: 0.8rem; font-weight: 800; text-transform: uppercase; margin-bottom: 0.6rem; color: var(--text-muted); letter-spacing: 0.05rem; }
        .form-input {
            width: 100%;
            padding: 0.9rem 1.1rem;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: var(--bg);
            font-size: 1rem;
            color: var(--text-main);
            outline: none;
            transition: border-color 0.3s;
        }
        .form-input:focus { border-color: var(--accent); }

        .badge {
            position: absolute; padding: 0.4rem 0.8rem; border-radius: 10px;
            font-size: 0.65rem; font-weight: 800; text-transform: uppercase;
            letter-spacing: 0.05rem;
        }
        .badge-type { bottom: 0.8rem; left: 0.8rem; background: var(--card-bg); color: var(--text-main); z-index: 2; box-shadow: 0 2px 10px rgba(0,0,0,0.1); opacity: 0.95; }
        .badge-contract { top: 0.8rem; right: 0.8rem; background: var(--success); color: white; z-index: 2; }
        .badge-no { top: 0.8rem; right: 0.8rem; background: var(--text-muted); color: white; opacity: 0.9; z-index: 2; }

        .photo-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 0.75rem; }
        .photo-item { aspect-ratio: 1; border-radius: 12px; overflow: hidden; position: relative; border: 1px solid var(--border); }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        .photo-item .remove { position: absolute; top: 0; right: 0; background: var(--danger); color: white; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; border-radius: 0 0 0 8px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .photo-add { aspect-ratio: 1; border: 2px dashed var(--border); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); cursor: pointer; transition: all 0.2s; }
        .photo-add:active { background: var(--border); transform: scale(0.95); }

        .gallery { display: flex; overflow-x: auto; snap-type: x mandatory; height: 300px; background: #000; }
        .gallery-item { flex: 0 0 100%; snap-align: center; display: flex; align-items: center; justify-content: center; }
        .gallery-item img { width: 100%; height: 100%; object-fit: contain; }

        .comm-selector {
            display: flex; background: var(--bg); border-radius: 14px; padding: 4px; margin-bottom: 0.75rem;
            border: 1px solid var(--border);
        }
        .comm-selector button {
            flex: 1; border: none; padding: 0.6rem; font-size: 0.8rem; font-weight: 700; border-radius: 10px;
            cursor: pointer; transition: all 0.3s var(--easing); background: transparent; color: var(--text-muted);
        }
        .comm-selector button.active { background: var(--card-bg); color: var(--accent); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* Typography accents */
        h2, h3 { font-family: 'Inter', sans-serif; }
        .font-display { font-family: 'Playfair Display', serif; }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react/": "https://esm.sh/react@^19.2.3/",
        "react": "https://esm.sh/react@^19.2.3",
        "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
        "uuid": "https://esm.sh/uuid@^13.0.0"
      }
    }
    </script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="light">

<div id="splash">
    <div class="splash-logo" id="splashLogo">
        <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(0.000000,2048.000000) scale(0.100000,-0.100000)" fill="var(--logo-fill)" stroke="none">
                <path d="M10064 16141 c-79 -26 -143 -64 -225 -133 -46 -38 -345 -282 -484 -394 -44 -36 -103 -85 -131 -109 -28 -25 -75 -64 -106 -87 -64 -50 -358 -287 -374 -303 -6 -5 -66 -55 -134 -110 -68 -55 -142 -116 -164 -136 -23 -19 -63 -53 -91 -74 -27 -22 -66 -53 -86 -70 -20 -16 -54 -44 -75 -62 -22 -17 -68 -56 -104 -85 -204 -169 -258 -207 -263 -189 -2 10 -5 160 -5 332 -1 173 -2 360 -2 417 l0 102 -515 0 -515 0 0 -867 0 -868 -87 -70 c-47 -38 -109 -88 -137 -110 -28 -21 -103 -82 -167 -135 -64 -52 -155 -126 -203 -165 -210 -168 -278 -231 -357 -330 -82 -102 -109 -160 -135 -295 -22 -114 -21 -4501 1 -4637 70 -430 341 -757 740 -893 -185 -62 105 -60 2009 -60 954 0 1737 4 1740 8 2 4 -11 9 -30 10 -43 3 -144 40 -144 53 0 5 -8 9 -18 9 -10 0 -24 9 -32 20 -8 11 -19 20 -26 20 -14 0 -66 65 -91 115 -102 201 -62 418 100 547 29 22 68 48 87 56 41 18 35 16 83 26 20 5 40 12 43 17 3 5 -703 9 -1680 9 -1672 0 -1686 0 -1740 20 -74 28 -100 51 -133 118 l-28 57 0 995 0 995 915 3 914 2 -276 278 c-321 324 -370 389 -402 547 l-13 60 -569 5 -569 5 -3 702 -2 701 47 34 c48 35 203 160 298 242 46 39 -344 282 450 366 24 19 85 69 135 110 50 41 -148 121 218 178 70 57 167 136 215 175 49 40 135 110 191 157 57 47 147 121 201 165 54 44 130 107 169 141 39 33 -96 80 127 105 58 45 90 71 330 269 77 63 177 144 222 180 95 74 191 153 396 325 79 66 157 131 175 145 17 13 81 66 143 117 217 180 335 273 348 273 10 0 148 -109 165 -130 3 -3 43 -37 90 -75 47 -38 137 -112 201 -165 64 -52 145 -117 180 -145 35 -27 66 -52 69 -55 7 -9 192 -163 305 -255 55 -44 131 -107 169 -140 39 -33 105 -87 146 -120 41 -33 86 -70 100 -83 14 -12 61 -51 104 -85 44 -34 203 -165 354 -290 151 -125 298 -245 327 -267 28 -21 58 -45 66 -52 26 -26 179 -148 186 -148 15 0 634 621 630 631 -1 4 -37 35 -80 70 -43 35 -111 91 -151 124 -40 33 -129 107 -198 165 -111 93 -204 170 -286 236 -15 12 -78 64 -141 115 -62 52 -125 103 -140 114 -14 11 -94 76 -177 145 -83 69 -219 181 -304 250 -225 184 -337 275 -445 365 -53 44 -114 94 -135 110 -50 39 -269 218 -295 242 -41 36 -141 119 -203 168 -35 28 -98 78 -139 113 -180 151 -383 198 -579 133z"/>
                <path d="M9568 12995 l-3 -285 283 0 282 0 0 285 0 285 -280 0 -279 0 -3 -285z"/>
                <path d="M10350 12995 l0 -285 283 0 282 0 -2 273 c-1 149 -3 278 -3 285 0 9 -63 12 -280 12 l-280 0 0 -285z"/>
                <path d="M9570 12200 l0 -290 278 2 277 3 3 288 2 287 -280 0 -280 0 0 -290z"/>
                <path d="M10350 12200 l0 -290 285 0 285 0 -2 288 -3 287 -282 3 -283 2 0 -290z"/>
            </g>
        </svg>
    </div>
    <div class="splash-title font-display" id="splashTitle">Emlak<span class="logo-port">Port</span></div>
    <div class="tagline" id="tagline">Made by Burak Özmen</div>
</div>

<div id="app">
    <header>
        <div class="header-top">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 2048 2048">
                    <g transform="translate(0.000000,2048.000000) scale(0.100000,-0.100000)" fill="var(--logo-fill)" stroke="none">
                        <path d="M10064 16141 c-79 -26 -143 -64 -225 -133 -46 -38 -345 -282 -484 -394 -44 -36 -103 -85 -131 -109 -28 -25 -75 -64 -106 -87 -64 -50 -358 -287 -374 -303 -6 -5 -66 -55 -134 -110 -68 -55 -142 -116 -164 -136 -23 -19 -63 -53 -91 -74 -27 -22 -66 -53 -86 -70 -20 -16 -54 -44 -75 -62 -22 -17 -68 -56 -104 -85 -204 -169 -258 -207 -263 -189 -2 10 -5 160 -5 332 -1 173 -2 360 -2 417 l0 102 -515 0 -515 0 0 -867 0 -868 -87 -70 c-47 -38 -109 -88 -137 -110 -28 -21 -103 -82 -167 -135 -64 -52 -155 -126 -203 -165 -210 -168 -278 -231 -357 -330 -82 -102 -109 -160 -135 -295 -22 -114 -21 -4501 1 -4637 70 -430 341 -757 740 -893 -185 -62 105 -60 2009 -60 954 0 1737 4 1740 8 2 4 -11 9 -30 10 -43 3 -144 40 -144 53 0 5 -8 9 -18 9 -10 0 -24 9 -32 20 -8 11 -19 20 -26 20 -14 0 -66 65 -91 115 -102 201 -62 418 100 547 29 22 68 48 87 56 41 18 35 16 83 26 20 5 40 12 43 17 3 5 -703 9 -1680 9 -1672 0 -1686 0 -1740 20 -74 28 -100 51 -133 118 l-28 57 0 995 0 995 915 3 914 2 -276 278 c-321 324 -370 389 -402 547 l-13 60 -569 5 -569 5 -3 702 -2 701 47 34 c48 35 203 160 298 242 46 39 -344 282 450 366 24 19 85 69 135 110 50 41 -148 121 218 178 70 57 167 136 215 175 49 40 135 110 191 157 57 47 147 121 201 165 54 44 130 107 169 141 39 33 -96 80 127 105 58 45 90 71 330 269 77 63 177 144 222 180 95 74 191 153 396 325 79 66 157 131 175 145 17 13 81 66 143 117 217 180 335 273 348 273 10 0 148 -109 165 -130 3 -3 43 -37 90 -75 47 -38 137 -112 201 -165 64 -52 145 -117 180 -145 35 -27 66 -52 69 -55 7 -9 192 -163 305 -255 55 -44 131 -107 169 -140 39 -33 105 -87 146 -120 41 -33 86 -70 100 -83 14 -12 61 -51 104 -85 44 -34 203 -165 354 -290 151 -125 298 -245 327 -267 28 -21 58 -45 66 -52 26 -26 179 -148 186 -148 15 0 634 621 630 631 -1 4 -37 35 -80 70 -43 35 -111 91 -151 124 -40 33 -129 107 -198 165 -111 93 -204 170 -286 236 -15 12 -78 64 -141 115 -62 52 -125 103 -140 114 -14 11 -94 76 -177 145 -83 69 -219 181 -304 250 -225 184 -337 275 -445 365 -53 44 -114 94 -135 110 -50 39 -269 218 -295 242 -41 36 -141 119 -203 168 -35 28 -98 78 -139 113 -180 151 -383 198 -579 133z"/>
                    </g>
                </svg>
                <span class="font-display">Emlak<span class="logo-port">Port</span></span>
            </div>
            <div style="display:flex; align-items:center; gap:0.5rem;">
                <button class="theme-toggle" id="themeToggle" onclick="app.toggleTheme()" aria-label="Temayı Değiştir">
                    <svg id="themeIconMoon" viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    <svg id="themeIconSun" style="display:none;" viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                </button>
                <span style="font-size: 0.65rem; opacity: 0.6; font-weight: 800; letter-spacing: 0.1rem; text-transform: uppercase;">Elite CRM</span>
            </div>
        </div>
        <div class="search-bar">
            <div class="search-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <input type="text" id="searchInput" placeholder="Adres veya sahip ara..." oninput="app.handleSearch()">
            </div>
            <button id="filterBtn" class="filter-toggle" onclick="app.toggleFilter()">Sözleşmeli</button>
        </div>
    </header>

    <main id="propertyList"></main>

    <button class="fab" onclick="app.openFormModal()">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
    </button>

    <div id="detailOverlay" class="detail-overlay">
        <div style="background: var(--card-bg); padding: 1rem 1.5rem; padding-top: calc(1rem + env(safe-area-inset-top)); display: flex; align-items: center; gap: 1rem; border-bottom: 1px solid var(--border);">
            <button onclick="app.closeDetail()" style="background:none; border:none; cursor:pointer; color: var(--text-main); padding: 0.5rem; margin-left: -0.5rem;">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            <h3 style="font-weight: 900; flex:1; margin:0; font-size: 1.2rem;">Portföy Detayı</h3>
        </div>
        <div id="detailBody" style="flex:1; overflow-y:auto;"></div>
    </div>

    <div id="modalContainer" class="modal-container">
        <div id="formModal" class="modal-content">
            <h2 id="modalTitle" style="margin-bottom: 2rem; font-weight: 900; font-size: 1.6rem; color: var(--text-main);">Yeni Portföy</h2>
            <form id="propertyForm" onsubmit="app.handleSave(event)">
                <div class="form-row">
                    <label>Adres Detayı</label>
                    <textarea id="f_address" class="form-input" rows="3" required placeholder="Tam adres bilgisini giriniz..."></textarea>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-row">
                        <label>Mülk Tipi</label>
                        <select id="f_type" class="form-input">
                            <option>Daire</option><option>Arsa</option><option>Tarla</option>
                            <option>Villa</option><option>Bahçe</option><option>İşyeri</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>Fiyat (₺)</label>
                        <input type="number" id="f_price" class="form-input" required placeholder="0">
                    </div>
                </div>

                <div class="form-row">
                    <label>Hizmet Bedeli (Komisyon)</label>
                    <div class="comm-selector">
                        <button type="button" id="btnCommPerc" onclick="app.setCommType('percentage')" class="active">Yüzdelik (%)</button>
                        <button type="button" id="btnCommFixed" onclick="app.setCommType('fixed')">Sabit Tutar (₺)</button>
                    </div>
                    <input type="number" id="f_comm_value" class="form-input" required placeholder="Oran veya Tutar" step="any">
                </div>

                <div class="form-row" style="display:flex; align-items:center; gap: 1rem; background: var(--bg); padding: 1rem; border-radius: 14px;">
                    <input type="checkbox" id="f_contract" style="width: 22px; height: 22px; accent-color: var(--primary);">
                    <label style="margin-bottom:0; color:var(--text-main); font-weight: 700;">Sözleşmeli Portföy</label>
                </div>
                <div class="form-row">
                    <label>Sahip Bilgisi</label>
                    <input type="text" id="f_owner" class="form-input" required placeholder="Ad Soyad">
                </div>
                <div class="form-row">
                    <label>Telefon</label>
                    <input type="tel" id="f_phone" class="form-input" required placeholder="05XX XXX XX XX">
                </div>
                
                <div class="form-row">
                    <label>Fotoğraflar</label>
                    <div id="photoGrid" class="photo-grid">
                        <div class="photo-add" onclick="document.getElementById('fileInput').click()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        </div>
                    </div>
                    <input type="file" id="fileInput" hidden multiple accept="image/*" onchange="app.handleFiles(this)">
                </div>

                <div style="display:flex; gap: 1rem; margin-top: 1rem;">
                    <button type="button" class="btn btn-outline" style="flex:1" onclick="app.closeModal()">Vazgeç</button>
                    <button type="submit" id="savePropertyBtn" class="btn btn-primary" style="flex:2">KAYDET</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Delete Confirmation Modal -->
    <div id="confirmModal">
        <div class="confirm-box">
            <h3 class="font-display">Silme Onayı</h3>
            <p>Bu portföyü kalıcı olarak silmek istediğinize emin misiniz? Bu işlem geri alınamaz.</p>
            <div class="confirm-actions">
                <button onclick="app.confirmDelete()" class="btn" style="background: var(--danger); color: white;">SİL</button>
                <button onclick="app.cancelDelete()" class="btn btn-outline">İPTAL</button>
            </div>
        </div>
    </div>

    <div id="toast">Çıkmak için tekrar basınız</div>
</div>

<script>
/**
 * APP LOGIC
 */
const initialSeed = [
    { id: '1', address: 'Sakarya Mah. Kıbrıs Şehitleri No:12, D:4, Biga', type: 'Daire', price: 3500000, commissionType: 'percentage', commissionValue: 2, owner: 'Ahmet Yılmaz', phone: '05321234567', contract: true, images: [], createdAt: Date.now() },
    { id: '2', address: 'Karabiga Sahil Yolu, Denize Sıfır Arsa', type: 'Arsa', price: 1250000, commissionType: 'percentage', commissionValue: 4, owner: 'Mehmet Demir', phone: '05559876543', contract: false, images: [], createdAt: Date.now() },
    { id: '3', address: 'Sinekçi Köyü Mevkii, Verimli Tarla', type: 'Tarla', price: 850000, commissionType: 'fixed', commissionValue: 25000, owner: 'Ayşe Kaya', phone: '05441230000', contract: true, images: [], createdAt: Date.now() },
    { id: '4', address: 'Biga Şehir Merkezi, Kiralık Dükkan', type: 'İşyeri', price: 2200000, commissionType: 'percentage', commissionValue: 2, owner: 'Can Aksoy', phone: '05324445566', contract: false, images: [], createdAt: Date.now() }
];

const app = {
    state: {
        properties: JSON.parse(localStorage.getItem('emlak_premium_db')) || initialSeed,
        search: '',
        filterContract: false,
        selectedId: null,
        editingId: null,
        pendingDeleteId: null,
        lastBackPress: 0,
        tempImages: [],
        currentCommType: 'percentage',
        theme: localStorage.getItem('emlakport_theme') || 'light'
    },

    init() {
        // SPLASH SEQUENCE
        setTimeout(() => {
            const splashLogo = document.getElementById('splashLogo');
            if(splashLogo) splashLogo.classList.add('visible');
            setTimeout(() => {
                const title = document.getElementById('splashTitle');
                if(title) title.classList.add('visible');
                setTimeout(() => {
                    const tagline = document.getElementById('tagline');
                    if(tagline) tagline.classList.add('visible');
                    setTimeout(() => {
                        const splash = document.getElementById('splash');
                        if(splash) splash.classList.add('hidden');
                    }, 1500);
                }, 600);
            }, 600);
        }, 500);

        if(!localStorage.getItem('emlak_premium_db')) this.save();
        this.render();
        this.updateThemeUI();
        
        history.replaceState({ page: 'base' }, null, "");
        history.pushState({ page: 'home' }, null, "");

        window.onpopstate = (e) => this.handlePopState(e);

        document.getElementById('modalContainer').onclick = (e) => {
            if(e.target.id === 'modalContainer') this.closeModal();
        };
    },

    toggleTheme() {
        this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
        localStorage.setItem('emlakport_theme', this.state.theme);
        this.updateThemeUI();
    },

    updateThemeUI() {
        const isDark = this.state.theme === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
        const iconMoon = document.getElementById('themeIconMoon');
        const iconSun = document.getElementById('themeIconSun');
        if(iconMoon) iconMoon.style.display = isDark ? 'none' : 'block';
        if(iconSun) iconSun.style.display = isDark ? 'block' : 'none';
        
        const metaTheme = document.querySelector('meta[name="theme-color"]');
        if (metaTheme) metaTheme.setAttribute('content', isDark ? '#111827' : '#1e293b');
    },

    save() { localStorage.setItem('emlak_premium_db', JSON.stringify(this.state.properties)); },

    showToast(msg) {
        const toast = document.getElementById('toast');
        if (toast) {
            toast.innerText = msg; toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
    },

    handlePopState(e) {
        const detailOverlay = document.getElementById('detailOverlay');
        const modalContainer = document.getElementById('modalContainer');
        const confirmModal = document.getElementById('confirmModal');

        if (confirmModal && confirmModal.classList.contains('active')) {
            confirmModal.classList.remove('active');
            this.state.pendingDeleteId = null;
            return;
        }

        const isDetailOpen = detailOverlay && detailOverlay.classList.contains('active');
        const isModalOpen = modalContainer && modalContainer.classList.contains('active');

        if (isDetailOpen || isModalOpen) {
            if (detailOverlay) detailOverlay.classList.remove('active');
            if (modalContainer) modalContainer.classList.remove('active');
            this.state.selectedId = null;
            this.state.editingId = null;
            this.state.tempImages = [];
            return;
        }

        const now = Date.now();
        if (now - this.state.lastBackPress < 2000) {
            // Exit sequence
        } else {
            this.state.lastBackPress = now;
            this.showToast("Çıkmak için tekrar basınız");
            history.pushState({ page: 'home' }, null, ""); 
        }
    },

    handleSearch() {
        const input = document.getElementById('searchInput');
        if (input) {
            this.state.search = input.value.toLowerCase();
            this.render();
        }
    },

    toggleFilter() {
        this.state.filterContract = !this.state.filterContract;
        const btn = document.getElementById('filterBtn');
        if (btn) btn.classList.toggle('active', this.state.filterContract);
        this.render();
    },

    setCommType(type) {
        this.state.currentCommType = type;
        const btnP = document.getElementById('btnCommPerc');
        const btnF = document.getElementById('btnCommFixed');
        const input = document.getElementById('f_comm_value');
        if (btnP) btnP.classList.toggle('active', type === 'percentage');
        if (btnF) btnF.classList.toggle('active', type === 'fixed');
        if (input) input.placeholder = type === 'percentage' ? 'Komisyon Oranı (%)' : 'Komisyon Tutarı (₺)';
    },

    async handleFiles(input) {
        if (!input.files || input.files.length === 0) return;
        const files = Array.from(input.files);
        
        for (const file of files) {
            try {
                const compressedData = await this.compressImage(file);
                this.state.tempImages.push(compressedData);
                this.updatePhotoGrid();
            } catch (error) {
                console.error("Görsel işleme hatası:", error);
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.state.tempImages.push(e.target.result);
                    this.updatePhotoGrid();
                };
                reader.readAsDataURL(file);
            }
        }
        input.value = "";
    },

    compressImage(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 1024;
                    let width = img.width;
                    let height = img.height;

                    if (width > MAX_WIDTH) {
                        height *= MAX_WIDTH / width;
                        width = MAX_WIDTH;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    } else {
                        reject(new Error("Canvas context error"));
                    }
                };
                img.onerror = reject;
            };
            reader.onerror = reject;
        });
    },

    removePhoto(index) {
        this.state.tempImages.splice(index, 1);
        this.updatePhotoGrid();
    },

    updatePhotoGrid() {
        const grid = document.getElementById('photoGrid');
        if (!grid) return;
        grid.innerHTML = this.state.tempImages.map((img, i) => `
            <div class="photo-item">
                <img src="${img}">
                <div class="remove" onclick="app.removePhoto(${i})">×</div>
            </div>
        `).join('') + `
            <div class="photo-add" onclick="document.getElementById('fileInput').click()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
            </div>
        `;
    },

    openFormModal(id = null) {
        this.state.editingId = id;
        this.state.tempImages = [];
        const form = document.getElementById('propertyForm');
        const modal = document.getElementById('modalContainer');
        if (!modal) return;
        
        if(id) {
            const p = this.state.properties.find(x => x.id === id);
            if (p) {
                document.getElementById('modalTitle').innerText = "Portföyü Düzenle";
                document.getElementById('f_address').value = p.address;
                document.getElementById('f_type').value = p.type;
                document.getElementById('f_price').value = p.price;
                document.getElementById('f_owner').value = p.owner;
                document.getElementById('f_phone').value = p.phone;
                document.getElementById('f_contract').checked = p.contract;
                document.getElementById('f_comm_value').value = p.commissionValue || 0;
                this.setCommType(p.commissionType || 'percentage');
                this.state.tempImages = [...(p.images || [])];
            }
        } else {
            document.getElementById('modalTitle').innerText = "Yeni Portföy";
            if (form) form.reset();
            this.setCommType('percentage');
        }
        
        this.updatePhotoGrid();
        modal.classList.add('active');
        history.pushState({ modal: 'form' }, null, "");
    },

    closeModal() {
        const modal = document.getElementById('modalContainer');
        if (modal && modal.classList.contains('active')) {
            history.back();
        }
    },

    handleSave(e) {
        e.preventDefault();
        const saveBtn = document.getElementById('savePropertyBtn');
        const addressVal = document.getElementById('f_address').value.trim();
        const priceVal = document.getElementById('f_price').value.trim();
        const ownerVal = document.getElementById('f_owner').value.trim();
        const typeVal = document.getElementById('f_type').value;
        const commVal = document.getElementById('f_comm_value').value;
        const phoneVal = document.getElementById('f_phone').value.trim();
        const contractVal = document.getElementById('f_contract').checked;

        if (!addressVal || !priceVal || !ownerVal || !typeVal) {
            alert("Lütfen zorunlu alanları doldurunuz.");
            return;
        }

        const originalText = saveBtn.innerText;
        saveBtn.innerText = "Kaydediliyor...";
        saveBtn.disabled = true;

        try {
            const data = {
                id: this.state.editingId || Date.now().toString(),
                address: addressVal,
                type: typeVal,
                price: Number(priceVal),
                commissionType: this.state.currentCommType,
                commissionValue: Number(commVal),
                owner: ownerVal,
                phone: phoneVal,
                contract: contractVal,
                images: this.state.tempImages,
                createdAt: Date.now()
            };

            if(this.state.editingId) {
                this.state.properties = this.state.properties.map(p => p.id === this.state.editingId ? data : p);
            } else {
                this.state.properties.unshift(data);
            }

            this.save();
            this.render();
            this.closeModal();
        } catch (err) {
            console.error(err);
            alert("Bir hata oluştu.");
        } finally {
            saveBtn.innerText = originalText;
            saveBtn.disabled = false;
        }
    },

    openDetail(id) {
        this.state.selectedId = id;
        const p = this.state.properties.find(x => x.id === id);
        const body = document.getElementById('detailBody');
        if (!p || !body) return;
        
        let earnings = 0;
        let commDisplay = "";
        const commValue = p.commissionValue || 0;
        const commType = p.commissionType || 'percentage';

        if (commType === 'percentage') {
            earnings = (p.price * commValue) / 100;
            commDisplay = `%${commValue}`;
        } else {
            earnings = commValue;
            commDisplay = `${this.fmt(commValue)} ₺`;
        }

        const images = p.images && p.images.length > 0 ? p.images : [];

        body.innerHTML = `
            <div class="gallery">
                ${images.length > 0 ? images.map(img => `<div class="gallery-item"><img src="${img}"></div>`).join('') : '<div class="gallery-item" style="color:#555">Fotoğraf Yok</div>'}
            </div>
            <div style="padding: 2rem;">
                <div style="font-weight:900; color:var(--accent); text-transform:uppercase; font-size:0.75rem; margin-bottom:0.5rem; letter-spacing: 0.1rem;">${p.type}</div>
                <h2 class="font-display" style="font-weight: 900; font-size: 1.6rem; margin-bottom: 1.5rem; line-height: 1.2; color: var(--text-main);">Emlak<span class="logo-port">Port</span> Detayı</h2>
                <div style="background:var(--card-bg); padding:1.5rem; border-radius:24px; display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; box-shadow: var(--shadow); margin-bottom: 2rem; border: 1px solid var(--border);">
                    <div>
                        <div style="font-size:0.65rem; color:var(--text-muted); font-weight:800; text-transform: uppercase;">FİYAT</div>
                        <div class="font-display" style="font-weight:900; font-size:1.4rem; color: var(--text-main);">${this.fmt(p.price)} ₺</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-size:0.65rem; color:var(--text-muted); font-weight:800; text-transform: uppercase;">HİZMET (${commDisplay})</div>
                        <div class="font-display" style="font-weight:900; font-size:1.4rem; color:var(--success);">${this.fmt(earnings)} ₺</div>
                    </div>
                </div>
                <div style="margin-top: 1.5rem; background:var(--card-bg); padding:1.2rem; border-radius:24px; border: 1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-weight:800; font-size:1.1rem; color: var(--text-main);">${p.owner}</div>
                        <div style="color:var(--text-muted); font-size:0.9rem;">${p.phone}</div>
                    </div>
                    <a href="tel:${p.phone}" class="btn btn-primary" style="padding: 0.75rem 1.2rem; width: auto; font-size: 0.85rem; text-decoration:none;">ARA</a>
                </div>
                
                <div style="margin-top: 2rem;">
                  <button onclick="app.openFormModal('${p.id}')" class="btn btn-outline" style="width: 100%; margin-bottom: 1rem;">DÜZENLE</button>
                  <button 
                      onclick="app.requestDelete('${p.id}')" 
                      style="background-color: #ef4444; color: white; border: none; width: 100%; padding: 12px; border-radius: 16px; font-weight: bold; cursor: pointer;">
                      BU PORTFÖYÜ SİL
                  </button>
                </div>
            </div>
        `;

        const detailOverlay = document.getElementById('detailOverlay');
        if (detailOverlay) detailOverlay.classList.add('active');
        history.pushState({ modal: 'detail' }, null, "");
    },

    closeDetail() { 
        const detailOverlay = document.getElementById('detailOverlay');
        if (detailOverlay && detailOverlay.classList.contains('active')) history.back(); 
    },

    requestDelete(id) {
        this.state.pendingDeleteId = id;
        const confirmModal = document.getElementById('confirmModal');
        if (confirmModal) confirmModal.classList.add('active');
        history.pushState({ modal: 'confirm' }, null, "");
    },

    cancelDelete() {
        const confirmModal = document.getElementById('confirmModal');
        if (confirmModal && confirmModal.classList.contains('active')) {
            history.back();
        }
    },

    confirmDelete() {
        const id = this.state.pendingDeleteId;
        if (!id) return;

        // Delete Logic
        this.state.properties = this.state.properties.filter(x => x.id !== id);
        this.save();
        this.render();
        
        // Manual UI cleanup to avoid double history.back race conditions
        const confirmModal = document.getElementById('confirmModal');
        const detailOverlay = document.getElementById('detailOverlay');
        if (confirmModal) confirmModal.classList.remove('active');
        if (detailOverlay) detailOverlay.classList.remove('active');
        
        this.state.pendingDeleteId = null;
        this.state.selectedId = null;
        
        // Go back to Home in history stack
        history.go(-2);
        
        this.showToast("Portföy silindi.");
    },

    fmt(n) { return new Intl.NumberFormat('tr-TR').format(n); },

    render() {
        const list = document.getElementById('propertyList');
        if (!list) return;
        const filtered = this.state.properties.filter(p => {
            const matches = p.address.toLowerCase().includes(this.state.search) || (p.owner && p.owner.toLowerCase().includes(this.state.search));
            return matches && (this.state.filterContract ? p.contract : true);
        });

        list.innerHTML = filtered.map(p => `
            <div class="property-card" onclick="app.openDetail('${p.id}')">
                <div class="card-image">
                    ${p.images && p.images.length > 0 ? `<img src="${p.images[0]}">` : '<span style="color:var(--text-muted); font-size:0.75rem; font-weight:800; text-transform: uppercase; letter-spacing: 0.05rem;">Görsel Yok</span>'}
                    <div class="badge badge-type">${p.type}</div>
                    <div class="badge ${p.contract ? 'badge-contract' : 'badge-no'}">${p.contract ? 'Sözleşmeli' : 'Serbest'}</div>
                </div>
                <div class="card-content">
                    <div class="card-address line-clamp-2">${p.address}</div>
                    <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                        <div class="card-price font-display">${this.fmt(p.price)} ₺</div>
                        <div style="font-size: 0.75rem; color: var(--accent); font-weight: 800; text-transform: uppercase;">${p.owner}</div>
                    </div>
                </div>
            </div>
        `).join('') || '<div style="text-align:center; padding: 4rem; color: var(--text-muted); font-weight: 600;">Portföy bulunamadı.</div>';
    }
};

// Global expose for inline handlers
window.app = app;
app.init();
</script>

<script type="module" src="/index.tsx"></script>
</body>
</html>